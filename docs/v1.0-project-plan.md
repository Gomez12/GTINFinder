# GTINFinder - Compleet Project Plan v1.0

**Document Status:** Eerste definitieve projectplan  
**Created:** 6 december 2025  
**Version:** 1.0  

---

## ğŸ¯ Project Doel
Webapplicatie voor GTIN (barcode) data verrijking met multi-API bronnen, LLM "golden record" creatie, en complete observability.

---

## ğŸ—ï¸ Technische Architectuur

### Core Services
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React App     â”‚    â”‚   Directus      â”‚    â”‚   PostgreSQL    â”‚
â”‚   (Frontend)    â”‚â—„â”€â”€â–ºâ”‚   (Headless CMS)â”‚â—„â”€â”€â–ºâ”‚   (Database)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Airflow       â”‚
                       â”‚   (Orchestration)â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Authentik     â”‚
                       â”‚   (SSO/OIDC)    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Processing Pipeline
```
GTIN Input â†’ Parallel API Calls â†’ Separate Storage â†’ LLM Golden Record â†’ Final Storage
```

---

## ğŸ“Š Database Schema (PostgreSQL via Directus)

### Collections
```sql
-- Core GTIN data
gtins (id, gtin_code, status, created_at, updated_at)

-- Raw data per source
gtin_raw_data (id, gtin_id, source_name, raw_data, quality_score, retrieved_at)

-- LLM golden records
gtin_golden_records (id, gtin_id, merged_data, confidence_score, created_at)

-- API source management
data_sources (id, source_name, api_endpoint, rate_limit, status, priority)

-- User management (via Authentik)
users (id, authentik_id, email, role, permissions)

-- Data quality tracking
data_quality_scores (id, gtin_id, source_name, completeness, accuracy, freshness)
```

---

## ğŸ”„ Airflow DAGs

### 1. `gtin_validator_dag`
- GTIN formaat validatie
- Checksum verificatie
- Duplicate detection

### 2. `parallel_api_fetcher_dag`
- Parallel calls naar alle bronnen:
  - Open Food Facts
  - Go-UPC
  - EAN Search
  - Barcode Lookup
  - Amazon Product API
- Error handling & retries
- Rate limiting management

### 3. `data_quality_scorer_dag`
- Compleetheid scoring
- Data freshness checks
- Source reliability assessment

### 4. `llm_golden_record_dag`
- Combine data met LLM (OpenAI/Anthropic)
- Quality validation
- Confidence scoring

### 5. `quality_validator_dag`
- Final data validation
- Anomaly detection
- Manual review flagging

---

## ğŸ¤– LLM Golden Record Strategy

### Multi-API Data Collection
```python
sources = {
    "open_food_facts": {"priority": 1, "reliability": 0.8},
    "go_upc": {"priority": 2, "reliability": 0.9},
    "ean_search": {"priority": 3, "reliability": 0.7},
    "amazon": {"priority": 4, "reliability": 0.85}
}
```

### LLM Prompt Template
```
"Combineer deze productbronnen tot Ã©Ã©n 'golden record':
- Prioriteit: 1) Compleetheid 2) Betrouwbaarheid 3) Recentheid
- Return gestructureerde JSON
- Include confidence score per field
- Flag conflicting data for review"
```

---

## ğŸ” SSO Integratie (Authentik)

### OAuth2/OIDC Flow
```
User â†’ Authentik Login â†’ Directus (OAuth2 Provider) â†’ React App (OIDC Client)
```

### Configuration
- Authentik als Identity Provider
- Directus met Authentik OAuth2 provider
- React app met OIDC client library
- Role-based access control

---

## ğŸ“ˆ Monitoring & Observability Stack

### Grafana Dashboards
1. **GTINFinder Overview**
   - Total GTINs processed
   - Success rate per API source
   - Golden record quality scores
   - Processing time trends

2. **Airflow Performance**
   - DAG run statistics
   - Task duration breakdown
   - Failure rates
   - Queue monitoring

3. **Database Health**
   - PostgreSQL metrics
   - Directus performance
   - Query analysis
   - Connection pool status

4. **API Source Monitoring**
   - Response times
   - Error rates
   - Rate limiting
   - Data freshness

### OpenTelemetry Integration
```python
# Custom metrics
gtin_processing_duration = Histogram("gtin_processing_duration")
api_success_rate = Counter("api_success_rate", ["source"])
llm_confidence_score = Histogram("llm_confidence_score")
```

---

## ğŸ§ª Testing Strategy

### Unit Tests (pytest)
- GTIN validation functions
- API client integrations
- LLM response parsing
- Database operations

### Integration Tests
- Airflow DAG execution
- Directus API connectivity
- End-to-end GTIN processing
- SSO authentication flow

### E2E Tests (Cypress)
- Frontend GTIN input
- Dashboard functionality
- User authentication
- Data export features

### LLM Testing
- Golden record quality validation
- Response consistency testing
- Data accuracy verification
- Prompt effectiveness measurement

---

## ğŸ› ï¸ Technology Stack

### Backend
- **Python 3.11+** - Airflow DAGs, API integrations
- **Directus 10+** - Headless CMS
- **PostgreSQL 15+** - Primary database
- **Airflow 2.7+** - Orchestration

### Frontend
- **React 18+** - UI framework
- **TypeScript** - Type safety
- **Vite** - Build tool
- **Tailwind CSS** - Styling

### Infrastructure
- **Docker Compose** - Container orchestration
- **Nginx** - Reverse proxy
- **Redis** - Caching & sessions

### Monitoring
- **Grafana** - Dashboards
- **OpenTelemetry** - Observability
- **Prometheus** - Metrics
- **Tempo** - Tracing

---

## ğŸ“ Project Structure
```
gtin-finder/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ frontend/                 # React app
â”œâ”€â”€ airflow/                  # DAGs & config
â”œâ”€â”€ directus/                 # Extensions & hooks
â”œâ”€â”€ monitoring/               # Grafana dashboards
â”œâ”€â”€ tests/                    # All test suites
â”œâ”€â”€ docs/                     # Documentation
â”‚   â””â”€â”€ v1.0-project-plan.md  # Dit document
â””â”€â”€ README.md                 # Project overview
```

---

## ğŸš€ Implementation Fases

### Fase 1: Foundation (Week 1-2)
- Docker Compose setup
- PostgreSQL + Directus
- Basic React app
- Authentik SSO

### Fase 2: Core Functionality (Week 3-4)
- GTIN input interface
- Directus collections
- Basic Airflow DAGs
- API integrations

### Fase 3: Data Enrichment (Week 5-6)
- Multi-API parallel fetching
- LLM golden record creation
- Quality scoring system
- Advanced DAGs

### Fase 4: Monitoring & Polish (Week 7-8)
- Grafana dashboards
- OpenTelemetry integration
- Comprehensive testing
- Performance optimization

---

## ğŸ’¡ Key Features

### User Experience
- Intuitive GTIN input interface
- Real-time processing status
- Comprehensive data visualization
- Batch upload capabilities

### Data Quality
- Multi-source validation
- Confidence scoring
- Manual review workflows
- Data lineage tracking

### Scalability
- Horizontal scaling ready
- Efficient resource usage
- Robust error handling
- Comprehensive monitoring

---

## ğŸ“‹ Decision Log

### Key Architectural Decisions
1. **Python als programmeertaal** - Beste integratie met Airflow en LLM libraries
2. **Multi-API + LLM strategie** - Superieur aan simpele data mergers
3. **Grafana + OpenTelemetry** - Industry standard observability stack
4. **Directus + PostgreSQL** - Robuste, schaalbare headless CMS oplossing
5. **Authentik SSO** - Complete identity management met OIDC support

### Technology Rationale
- Alle componenten zijn open-source en goed ondersteund
- Schaalbare architectuur voor toekomstige groei
- Complete observability voor production monitoring
- Modern tech stack met actieve communities

---

## ğŸ”„ Version History

**v1.0** - 6 december 2025
- Eerste complete projectplan
- Definitieve architectuur en technology stack
- Volledige implementatie roadmap
- Comprehensive monitoring en testing strategie

---

**Document Status:** ARCHIVED - Dit is het definitieve v1.0 projectplan  
**Next Steps:** Implementatie volgens Fase 1 planning  
**Contact:** Project team voor vragen en verduidelijkingen
